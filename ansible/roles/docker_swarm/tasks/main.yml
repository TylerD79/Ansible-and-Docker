---
  - name: Check if "Swarm Mode" is enabled.
    shell: docker info
    changed_when: False
    register: docker_info

  - name: Start a Swarm
    shell: docker swarm init --advertise-addr {{ ansible_docker0.ipv4.address }}
    when: "docker_info.stdout.find('Swarm: active') == -1"

  - name: Get the worker join-token.
    shell: docker swarm join-token -q worker
    changed_when: False
    register: docker_worker_token

  - name: Create overlay network
    docker_network:
      name: ejosh_network
      driver: overlay
    ignore_errors: yes
    #this errors but creates the network

  #- name: Join the pending Swarm worker nodes.
  #  shell: docker swarm join --token "{{ docker_worker_token.stdout }}"
  #    {{ ansible_default_ipv4.address }}:2377

  #- name: Display all variables/facts known for a host
  #  debug:
  #    var: hostvars[inventory_hostname]
